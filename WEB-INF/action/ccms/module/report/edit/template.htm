<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<script language="JavaScript" type="text/javascript"
	src="${def:context}/action/pub/dtree"></script>
<title>修改报表</title>
</head>
<body>
	<div class="panel panel-default col_mainInner">
		<div class="panel-heading col_main_body_title text-center">
				<div class="col-xs-9 col-sm-9 col-md-9 col-lg-9 col-md-offset-1 col-lg-offset-1">
				<h2 class="panel-title">
					修改报表<span id="typeTitleSpan"></span>
				</h2>
			</div>
			<div class="col-xs-2 col-sm-2 col-md-1 col-lg-1"
				style="margin-top: -12px;">
				<button type="button" id="save_btn" class="btn btn-primary btn-md">保&nbsp;存</button>
			</div>
		</div>
		<div class="panel-body col_main_body">
			<div class="col-xs-3 col-sm-3 col-md-2 col-lg-2">
				${inc:/action/ccms/config_type?search_subject_id=${fld:subject_id}}
			</div>
			<div class="col-xs-9 col-sm-9 col-md-10 col-lg-10">
				<form class="form-horizontal" role="form" method="post"
					id="formEditor" name="formEditor">
					<input type="hidden" id="tuid" name="tuid" value="${fld:tuid}" /> <input
						name="subject_id" type="hidden" value="${fld:subject_id}"
						preserve="true" /> <input name="group_type" id="group_type" type="hidden" value=""
						preserve="true" />
					<div class="row clearfix">
						<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
							<div class="form-group">
								<label
									class="col-xs-2 col-sm-2 col-md-2 col-lg-2 control-label col-xs-offset-1 col-sm-offset-1 col-md-offset-1 col-lg-offset-1 required">业务</label>
								<div class="col-xs-3 col-sm-3 col-md-3col-lg-3">
									<input name="table_id" type="hidden" value="" id="table_id" />
									<input class="form-control" type="text" id="table_alias"
										name="table_alias" size="30" readonly class="readonly"
										value="" />

								</div>
								<div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
									<img src="${def:context}/images/search.gif"
										style="cursor: pointer;" id="pickOpenNotCenter" title="查询表名" />
									<img src="${def:context}/images/clear.gif"
										style="cursor: pointer;" id="pickClear" title="清除选择的内容" />
								</div>
							</div>
						</div>
						<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
							<div class="form-group">
								<label
									class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label required">报表中文名称</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">

									<input name="report_name_cn" type="text" size="35"
										value="${report_name_cn}" id="report_name_cn"
										class="form-control" />

								</div>
							</div>
							<div class="form-group" id="engine_type">
								<label
									class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label  required">报表引擎</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
									<input name="engine_type" type="radio" value="0" />琴棋报表&nbsp; <input
										name="engine_type" type="radio" value="1" />简表 &nbsp; <input
										name="engine_type" type="radio" value="2" />图表 &nbsp;
								</div>
							</div>
							<div class="form-group" id="report_type">
								<label
									class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label required">报表类型</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
									<input name="report_type" type="radio" value="0">平面报表&nbsp;</input>
									<input name="report_type" type="radio" value="1">分组报表&nbsp;</input>
									<input name="report_type" type="radio" value="2">交叉报表</input>
								</div>
							</div>
							<div class="form-group" id="is_drill">
								<label
									class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label required">是否钻取</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
									<input name="is_drill" type="radio" value="0" />不钻取&nbsp; <input
										name="is_drill" type="radio" value="1" />钻取 &nbsp;
								</div>
							</div>
							<div class="form-group" id="is_show_zero">
								<label
									class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label required">零是否显赤为空</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
									<input name="is_show_zero" type="radio" value="0" />显示为空&nbsp;
									<input name="is_show_zero" type="radio" value="1" />显示为零 &nbsp;
								</div>
							</div>
							<div class="form-group" id="show_total_type">
								<label
									class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label  required">是否显示汇总</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
									<input name="show_total_type" type="radio" value="0" />不汇总&nbsp;
									<input name="show_total_type" type="radio" value="1" />列汇总&nbsp;
									<input name="show_total_type" type="radio" value="2" />行汇总&nbsp;
									<input name="show_total_type" type="radio" value="3" />都汇总
									&nbsp;
								</div>
							</div>
							<div class="form-group" id="show_percent_type">
								<label
									class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label required">
									是否显示百分比</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
									<input name="show_percent_type" type="radio" value="0" />不显示&nbsp;
									<input name="show_percent_type" type="radio" value="1" />列显示
									&nbsp; <input name="show_percent_type" type="radio" value="2" />
									行显示 &nbsp; <input name="show_percent_type" type="radio"
										value="3" />都显示 &nbsp;
								</div>
							</div>
						</div>

						<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
							<div class="form-group" id="report_name_en">
								<label
									class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label required">报表英文名称</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">

									<input name="report_name_en" type="text" size="35" value=""
										class="form-control" />

								</div>
							</div>
							<div class="form-group" id="jor_file_name">
								<label
									class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label ">简表配置文件路径</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">

									<input name="jor_file_name" type="text" size="35" value=""
										class="form-control" />

								</div>
							</div>

							<div class="form-group" id="is_merge_zero">
								<label
									class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label  required">是否合并空行及零行</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">

									<input name="is_merge_zero" type="radio" value="0" />不合并&nbsp;
									<input name="is_merge_zero" type="radio" value="1" />合并 &nbsp;

								</div>
							</div>

							<div class="form-group" id="is_merge_vertical">
								<label
									class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label required">是否垂直合并表头</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
									<input name="is_merge_vertical" type="radio" value="0" />不合并&nbsp;
									<input name="is_merge_vertical" type="radio" value="1" />合并
									&nbsp;
								</div>
							</div>
							<div class="form-group" id="show_sub_total_type">
								<label
									class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label required">是否显示小计汇总</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
									<input name="show_sub_total_type" type="radio" value="0" />不汇总&nbsp;
									<input name="show_sub_total_type" type="radio" value="1" />列汇总
									&nbsp; <input name="show_sub_total_type" type="radio" value="2" />行汇总&nbsp;
									<input name="show_sub_total_type" type="radio" value="3" />都汇总&nbsp;
								</div>
							</div>
							<div class="form-group" id="col_num_filter">
								<label
									class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label required">查询显示列数</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
									<select name="col_num_filter" class="form-control" id="col_num_filter">
											<option value=""></option>
											<option value="1">1</option>
											<option value="2">2</option>
											<option value="3">3</option>
											<option value="4">4</option>
									</select>
								</div>
							</div>
						</div>
						<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
							<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
								<div class="form-group" id="if_customer_design">
									<label
										class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label required">是否客户自定义条件</label>
									<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
										<input name="if_customer_design" type="radio" value="0" />否&nbsp;
										<input name="if_customer_design" type="radio" value="1" />是&nbsp;
									</div>
								</div>
							</div>
						</div>
						<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
							<div class="form-group">
								<label class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label">界面JS代码<br>(调用界面时执行)</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">

									<textarea name="form_js" cols="40" rows="4"
										class="form-control"></textarea>

								</div>
							</div>
							<div class="form-group">
								<label
									class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label ">查询前JS代码<br>(查询前执行)</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">

									<textarea name="searchpre_js" cols="40" rows="4"
										class="form-control"></textarea>

								</div>
							</div>
							<div class="form-group" id="report_sql">
								<label
									class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label ">SQL语句</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">

									<textarea name="report_sql" cols="40" rows="4"
										class="form-control"></textarea>

								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label">备注</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">

									<textarea name="remark" cols="40" rows="2" maxlength="200"
										class="form-control"></textarea>

								</div>
							</div>
						</div>
						<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
							<div class="form-group">
								<label
									class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label ">加载条件界面后JS代码<br>(完成加载条件界面后执行)</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">

									<textarea name="loadfilter_js" cols="40" rows="4"
										class="form-control"></textarea>

								</div>
							</div>

							<div class="form-group">
								<label
									class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label ">查询后JS代码<br>(完成查询后执行)</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
									<textarea name="searchback_js" cols="40" rows="4"
										class="form-control"></textarea>
								</div>
							</div>
							<div class="form-group" id="is_sql_phrase">
								<label
									class="col-xs-6 col-sm-6 col-md-6 col-lg-6 control-label required">SQL语句类型</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
									<input name="is_sql_phrase" type="radio" value="0" />存储过程
									&nbsp; <input name="is_sql_phrase" type="radio" value="1" />SQL语句&nbsp;
								</div>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
		<input type="hidden" name="actionroot" id="actionroot"
			value="${def:actionroot}" />
	</div>
	<script language="javascript">
	function EditClass(){
		this.init=function(){
			var obthis=this;
			obthis.initDate();
			$("#save_btn").on("click", function() {
				$(".error").empty();
				var url = "${def:actionroot}/update";
				ajaxCall(url, {
					method : "post",
					progress : true,
					form: "formEditor",
					button: "save_btn",
					dataType : "script",
					success : function() {
						$Dialog().notice("修改成功！",2000,function(){
							gotoBack();
					});
					}
				});
			});
			//业务选取框
			$("#pickOpenNotCenter").on("click",function(){
    			var url = "${def:context}/action/ccms/pub/pick/table/crud?id=table_id&name=table_alias&pickId=pickOpen&subject_id="+"${fld:subject_id}";
    			$Dialog().open({url:url,id:"pickOpen",width:800,height:600});
    		});
    		$("#pickClear").on("click",function(){
    			document.formEditor.table_id.value='';
    			document.formEditor.table_alias.value='';
    		});
    		$("input[type=radio][name='engine_type']").on("change",function(){
    			var val=$(this).val();
    			obthis.change(val);
    		});
    		obthis.change('${fld:engine_type}');
		};
		this.initDate=function(){
			document.formEditor.tuid.value = "${fld:tuid}";
			document.formEditor.report_name_cn.value = "${fld:report_name_cn}";
			document.formEditor.report_name_en.value = "${fld:report_name_en}";
			document.formEditor.report_sql.value = "${fld:report_sql}";
			document.formEditor.remark.value = "${fld:remark}";
			setComboValue("col_num_filter","${fld:col_num_filter}","formEditor");
			document.formEditor.subject_id.value = "${fld:subject_id}";
			document.formEditor.table_id.value = "${fld:table_id}";
			document.formEditor.table_alias.value = "${fld:table_alias}";
			document.formEditor.form_js.value = "${fld:form_js}";
			document.formEditor.loadfilter_js.value = "${fld:loadfilter_js}";
			document.formEditor.searchback_js.value = "${fld:searchback_js}";
			document.formEditor.searchpre_js.value = "${fld:searchpre_js}";
			setCheckboxValue("report_type","${fld:report_type}","formEditor");
			setCheckboxValue("show_total_type","${fld:show_total_type}","formEditor");
			setCheckboxValue("show_sub_total_type","${fld:show_sub_total_type}","formEditor");
			setCheckboxValue("show_percent_type","${fld:show_percent_type}","formEditor");
			setCheckboxValue("if_customer_design","${fld:if_customer_design}","formEditor");
			setCheckboxValue("is_sql_phrase","${fld:is_sql_phrase}","formEditor");
			setCheckboxValue("is_merge_zero","${fld:is_merge_zero}","formEditor");
			setCheckboxValue("is_merge_vertical","${fld:is_merge_vertical}","formEditor");
			setCheckboxValue("is_show_zero","${fld:is_show_zero}","formEditor");
			setCheckboxValue("engine_type","${fld:engine_type}","formEditor");
			document.formEditor.jor_file_name.value = "${fld:jor_file_name}";
			setCheckboxValue("is_drill","${fld:is_drill}","formEditor");
			document.formEditor.group_type.value = "${fld:group_type}";
		};
		this.change=function(val){
			if(val=='0'){
				$("#report_sql").show();
				$("#is_sql_phrase").show();
				$("#jor_file_name").hide();
				$("#report_sql").show();
				$("#is_sql_phrase").show();
				$("#is_merge_zero").show();
				$("#is_merge_vertical").show();
				$("#show_sub_total_type").show();
				$("#report_type").show();
				$("#is_drill").show();
				$("#is_show_zero").show();
				$("#show_total_type").show();
				$("#show_percent_type").show();
				$("#if_customer_design").show();
			}else if(val=='1'){
				$("#jor_file_name").show();
				$("#is_merge_zero").hide();
				$("#is_merge_vertical").hide();
				$("#show_sub_total_type").hide();
				$("#report_type").hide();
				$("#is_drill").hide();
				$("#is_show_zero").hide();
				$("#show_total_type").hide();
				$("#show_percent_type").hide();
				$("#if_customer_design").hide();
				$("#report_sql").hide();
				$("#is_sql_phrase").hide();
				
			}else{
				$("#report_sql").show();
				$("#is_sql_phrase").show();
				$("#jor_file_name").hide();
				$("#is_merge_zero").hide();
				$("#is_merge_vertical").hide();
				$("#show_sub_total_type").hide();
				
				$("#report_type").hide();
				$("#is_drill").hide();
				$("#is_show_zero").hide();
				$("#show_total_type").hide();
				$("#show_percent_type").hide();
				$("#if_customer_design").hide();
			};
		};
	}
	var editClass=null;
	$(document).ready(function() {
		editClass=new EditClass();
		editClass.init();
		document.formEditor.group_type.value = defaultTypeVal;
		typeOperate=function(t,n){
			document.formEditor.group_type.value = t;
			document.getElementById("typeTitleSpan").innerHTML = "&nbsp;&nbsp;-&nbsp;&nbsp;"+n;
		};
	});
	</script>
</body>
</html>

